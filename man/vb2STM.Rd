% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Vb2STM.R
\name{vb2STM}
\alias{vb2STM}
\title{Convert Von Bertalanffy Growth Parameters to Size Transition Matrix}
\usage{
vb2STM(lbinmin, lbinmax, gap, Linf, k, to, growsd, maxage = 30)
}
\arguments{
\item{lbinmin}{Numeric. Minimum length bin (mm or cm)}

\item{lbinmax}{Numeric. Maximum length bin (mm or cm)}

\item{gap}{Numeric. Width of length bins (mm or cm)}

\item{Linf}{Numeric. Von Bertalanffy asymptotic length parameter}

\item{k}{Numeric. Von Bertalanffy growth rate parameter (per year)}

\item{to}{Numeric. Von Bertalanffy theoretical age at length 0}

\item{growsd}{Numeric. Standard deviation of growth variability (measurement error
and individual variation). Larger values increase uncertainty in transitions.}

\item{maxage}{Numeric. Maximum age for diagnostic plot (default = 30 years)}
}
\value{
A size transition matrix where each column sums to 1, representing
transition probabilities from one length bin (column) to another (row) over
one year. Matrix is truncated to the range \link{lbinmin, lbinmax}.
}
\description{
Creates a size transition matrix (STM) from Von Bertalanffy growth parameters
with no-shrinkage constraint. The function accounts for truncation bias when
preventing backward transitions using truncated normal distribution theory.
}
\details{
The function implements a no-shrinkage constraint by:
\itemize{
\item Truncating the normal growth distribution at the current bin
\item Adjusting the mean growth using inverse Mills ratio to correct for
truncation bias
\item Adding the truncated probability mass to the diagonal (staying in same bin)
}

This approach maintains consistency with the Von Bertalanffy growth curve even
with large growth variability (growsd), unlike naive truncation which causes
upward bias in mean length-at-age.

A diagnostic plot is produced showing STM predictions (black points with 95\% CI)
against the Von Bertalanffy curve (red line).
}
\examples{
# Create STM for Western Rock Lobster
stm <- vb2STM(lbinmin = 20, lbinmax = 140, gap = 2,
              Linf = 120, k = 0.1, to = 0,
              growsd = 3, maxage = 30)

# Check that columns sum to 1
colSums(stm)

}
\seealso{
\code{\link{pnorm}}, \code{\link{dnorm}}
}
